# neovim

[Neovim](https://www.neovim.io/) modal editor configuration for Dustin Venegas. 



## Setup

These instructions are based on the [Neovim Installation Instructions](https://github.com/neovim/neovim/wiki/Installing-Neovim).



### Windows



#### nvim Chocolatey Packages

[Chocolatey](https://chocolatey.org/) is recommended to install and maintain Neovim on Windows. 

[Install Chocolatey](https://chocolatey.org/install).

Open an elevated (admin) PowerShell Console and change directories to `<dotfiles checkout>/nvim`. Run Chocolatey against the [chocolatey-packages.config](./chocolatey-packages.config).

```ps1
cd $HOME/dotfiles/nvim/
choco install chocolatey-packages.config
```



#### Add `neovim.exe` and `neovim-qt.exe` to your System PATH variable
Next, let's see if we have the environment variable available. Open a **new instance** of Powershell.

```ps1
# Should return c:\tools\neovim\Neovim\bin
[System.Environment]::GetEnvironmentVariable("PATH", "Machine") -Split ';' | Where-Object { $_ -like 'c:\tools\neovim\Neovim\bin*' }
```

Your PATH variable must contain an entry for Neovim's bin directory. The neovim Chocolatey package, as of 2018-02, created a directory at `c:\tools\neovim\Neovim\bin\`. You'll need to add your neovim bin diretcory to your System PATH.

```ps1
# set a variable pointing at your neovim directory
$neovimPath = 'C:\tools\neovim\Neovim\bin'

# AS ADMIN, appends $neovimPath variable contents to system PATH variable
[Environment]::SetEnvironmentVariable("PATH", "$($env:PATH);$neovimPath", "Machine")
```

Confirm by opening up a *new* shell, typing `nvim-qt.exe`, and pressing enter. 



#### Python 2/3 Support

The [`chocolatey-packages`](chocolatey-packages.config) bundle should include `python2` and `python3`. You can install them directly using `choco install 'python2;python3' -y`. Binaries for `python`, `pip2` and `pip3` should all be added to your system PATH after logging out and back in.


##### Virtual Environment

Neovim recommends a dedicated python virtualenv. Python recommends using [`pipenv`](https://github.com/pypa/pipenv) for this purpose.

The python virtualenvs and pipfiles dedicated for neovim are kept under [`python-envs/`](python-envs/). Virtual environments prevent polluting the global library with dependencies. Locating the `python` binaries across distributes also becomes easier. `pipenv -py` from a virtualenv will return the correct `python` path across all platforms.

First, we need to install python2 and python3.

```ps1
# From any directory. pipenv can create/manage python deps and venvs
pip3 install --upgrade pipenv
pip2 install --upgrade pipenv
```

Next, use `pipenv` to install the latest dependencies and setup a virtual environment. Finally, we print the virtualenv path to the python executable.

```bash
# setup base python 2.7 virtualenv
pushd nvim/python-envs/2.7/
pipenv install
pipenv --py
popd

# setup base python 3.6 virtualenv
pushd nvim/python-envs/3.6/
pipenv install
pipenv --py
popd
```

Finally, edit your machine's `init.vim` (not the dotfiles one) using Ex command `:edit $MYVIMRC`. Specify **both** python executeables **before** it source loads this dotfiles repository's[`init.vim`](init.vim).

```viml
" Maps to dotfiles virtualenv versions for neovim using pipenv
" See: ~/dotfiles/nvim/README.md#virtual-environment
" MUST APPEAR BEFORE dotfiles/nvim/init.vim is source loaded
let g:python3_host_prog='C:\Users\dusti\.virtualenvs\3.6-LFOTLC8X\Scripts\python.exe'
let g:python_host_prog='C:\Users\dusti\.virtualenvs\2.7-8oiZRLVE\Scripts\python.exe'

" Autogenerated by provision.ps1 on FAKE, I write this by hand...
" Set our dotfiles/nvim/ directory as the first runtimepath to check for files
set runtimepath^=~/dotfiles/nvim/

" Source the dotfiles init.vim
source ~/dotfiles/nvim/init.vim
```



##### Creating and Modifying Virtual Environments

Keep these in mind when creating or modifying the python virtualenv instances:
  * Each folder under `python-venvs` should represent an environment and contain a `Pipfile`
  * Each `Pipfile` contains the python dependencies, specifically for neovim, for the virtual environment
  * Each python environment must include the `neovim` module


```ps1
# Uncomment to create a new virtualenv directory, if adding an entirely new virtualenv
# New-Item -type Directory python-venvs/my-special-version/

# Change directories to the version
cd python-venvs/my-special-version

# Uncomment to bootstrap a new virtualenv, create a pipfile, and specify a python version
# 2.7 represents the version number of python to use
pipenv --python 2.7

# Up-stall-grade neovim for python2
pip2 install --upgrade neovim
```


Check your neovim python health with the following Ex command:

```viml
:CheckHealth
```


### Source from `init.vim`

This dotfiles vim configuration expects to be [source](https://neovim.io/doc/user/repeat.html#:source) loaded from the appropriate [`XGD_BASE_DIR`](https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html):
  * Windows: `~/AppData/Local/nvim/init.vim`
  * Linux: `~/.config/nvim/init.vim` 

Below is an example `init.vim` file which uses the default checkout location on a Windows machine.

```viml
" Add our git dotfiles checkout to neovim's rtp for loading scripts
set runtimepath^=~/dotfiles/nvim/

" Load our configuration
source ~/dotfiles/nvim/init.vim
```

_Note,_ Source loading the dotfiles configuration has pros and cons. Some operating systems don't posses full symlinking capabilities. Consistently source loading across all operating systems just makes things easier.



## Plugins

This configuration is intended to gracefully handle missing plugins, themes, and fonts. vim-plug is a hard depndency and is therefore committed directly to the repository. You'll need to run `:PlugInstall` in short order to load plugins, themes, etc.

Why do we take a hard dependency on vim-plug, but ignore the plugin submodules? Some plugins have different platform requirements. They've been for Windows compatability in the past. While not ideal for consistency, this has been sufficient for my needs.

**Note,** if you try to execute `nvim-qt.exe` and a window opens but never really loads then there might be a missing configuration issue. Run `nvim.exe` to ensure there are no configuration errors. You may have to run `:PlugInstall` using the command-line version, `nvim.exe`. 



### vim-plug

[junegunn/vim-plug](https://github.com/junegunn/vim-plug) is used to manage neovim plugins. It was selected for its simplicity. 

  * `:PlugInstall` installs the plugins defined.
  * `:PlugUpgrade` updates [`~/dotfiles/nvim/autoload/plug.vim`](./autoload/plug.vim) to the latest vim-plug version. After verifying the changes, they can be committed to the dotfiles repository for distribution.



### vim-gitgutter

[airblade/vim-gitgutter](https://github.com/airblade/vim-gitgutter) adds markers to the gutter that indicate if lines were added, modified, or removed in git. 

  * `:GitGutterToggle` toggles the feature on/off
  * `]c`, `[c`, goes to next and previous hunks



### junegunn/fzf

[junegunn/fzf](https://github.com/junegunn/fzf) is both the `fzf` source code and basic vim bindings for `fzf`.  `fzf` is a cross-platform "fuzzy finder". It takes lists and provides "fuzzy" filtering based on partial or near matches. 

This plugin depends on the `fzf` binary in your PATH. It adds the `FZF` ex-mode command to vim.

  * `:FZF`: Open fzf to the current directory (default)



#### External Dependencies

You can install `fzf` using a package manager.

  * Windows: `choco install fzf -y`
  * macOS: `brew install fzf`

Alternatively, the `junegun/fzf` plugin directory *is* the `fzf` source code. The `/bin` directory is already included in the search path. On a POSIX system, you could use a vim-plug "after" command to build `fzf`.

```viml
Plug 'junegunn/fzf', { 'dir': '~/.fzf', 'do': './install --all' }
```

Windows would need to take on additional dependencies to perform the same installation style. This dotfiles repository prefers a manual installation due to differing commands on Windows and Linux.



### junegunn/fzf.vim

[junegunn/fzf.vim](https://github.com/junegunn/fzf.vim) contains vim-specific `fzf` bindings. This is the thing we customize in vim.

#### Bindings

  * `CTRL-T`/`CTRL-X`/`CTRL-V`: Open in new tab/split/vsplit
  * `:FzfSomeCommand!`: Fullscreen version of Fzf commands
  * `<C-x><C-k>`: Dictionary word complete

#### Customizations

  * `:Fzf<command>`: Prefix for all commands. Custom, in order to locate fzf specific functions easily.

#### Other

An `g:fzf_action` exists to configure bindings in addition to the default `CTRL-T`, `CTRL-X`, and `CTRL-V` versions.

